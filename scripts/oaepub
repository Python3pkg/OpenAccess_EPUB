#!/usr/bin/env python3

import openaccess_epub as oae
import openaccess_epub.utils as utils
from openaccess_epub.settings import *
import os.path
import logging
import shutil


def main():
    """The main method of the launch script"""
    args = oae.OAEParser()
    #Configure logging, use name from input
    if args.input:
        logname = utils.getFileRoot(args.input) + '.log'
        logpath = os.path.join(args.output, logname)
    elif args.batch:
        logname = utils.getFileRoot(args.batch) + '.log'
        logpath = os.path.join(args.batch, logname)
    elif args.parallel_batch:
        logname = utils.getFileRoot(args.parallel_batch) + '.log'
        logpath = os.path.join(args.parallel_batch, logname)
    elif args.zip:
        logname = utils.getFileRoot(args.zip) + '.log'
        logpath = os.path.join(args.output, logname)
    logging.basicConfig(filename=logpath, level=logging.DEBUG)
    logging.info('openaccess_epub Log v.{0}'.format(oae.__version__))
    #Run the main script
    oae.main(args)
    #Cache the log
    if SAVE_LOG:
        shutil.copy2(logpath, CACHE_LOG)


if __name__ == '__main__':
    main()
